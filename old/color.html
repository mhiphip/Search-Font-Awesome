  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/3.2.0/css/bootstrap-colorpicker.min.css" rel="stylesheet">
  <script src="/docs/data/color-scheme.min.js"></script>
<!-- form -->
<div class="jumbotron text-dark border-primary mb-3">
 <form id='fform'>
  <div id="cpformat" class="form-row">
  </div>
</br>
<button id="formatsub" class="btn btn-info" disabled>Change</button>
</form>
</div>

<script>

// color format
var $fform = $('#fform');
var $cpformat = $('#cpformat');
var $formatsub = $('#formatsub');
var $def = {input: 'default', scheme: '', format: 'rgb'};

pvar $data = {"data":[{"name":"Input", "gid": "igr", "values":["default","random","names"]},{"name":"Scheme", "gid": "sgr","values":["complementary","triad","tetrad","splitcomplement"]}, {name: "Format", gid: "fgr", values: ['rgb', 'hsl', 'hex', 'auto']}], id: function() { return this.name.toLowerCase();}};

$.get('data/template.json',
  function (temp) {
  var html = Mustache.render(temp.select, $data);
  $cpformat.append(html);
  GetCps(temp.colors);
  
// form change
  $fform.on('change', function(e) { 
  $formatsub.prop('disabled', false);
  });
});

</script>

<!-- color -->
<div class="jumbotron card border-secondary shadow p-3 mb-3 bg-white">
<form id="cpinput">
</form>
</div>

<script>
// color picker
var $cpinput = $('#cpinput');
var $cpinputs = $("div[id^='cp']");

var $dcolors = [{id: "cpfront", label: "Frontground", color: "grey", value: "#888"}, {id: "cpback", label: "Background", color: "transparent", value: "transparent"}];

function GetCps(temp) {
var data = {data: $dcolors};
var html = Mustache.render(temp.div, data);
$cpinput.append(html);

$cpinput.data({values: $dcolors.map(it => it.value), temp: temp.dropdown, format: 'rgb'}).trigger('change');
}

$cpinput.on('change', function(e) {
var $this = $(this);
var data = $this.data();
var $div = $this.find('div');
var $dps = $this.find('.dropdown-menu');
var $dins = $this.find('input');
var dphtml = Mustache.render(data.temp, 
data);

// add dropdown
$dps.each(function(i) {
$(this).html(dphtml);
var id = $(this).attr('id').split('_')[0];

// change color
$(this).find('a').on('click', {ip: `#${id}_text`}, function(e){
  e.preventDefault();
  $(e.data.ip).val($(this).text()).change();
  });
});

// add picker
$div.colorpicker({format: data.format});
});


// submit
$formatsub.on('click', function(e) { 
e.preventDefault();  
var $div = $cpinput.find('div');

_.keys($def).forEach(id => $def[id] = $fform.children().find(`#${id}`).val());
GetInput($def.input);
});

function GetInput(input) {
var $dcolors = [{id: "cpfront", label: "Frontground", color: "grey", value: "#888"}, {id: "cpback", label: "Background", color: "transparent", value: "transparent"}];
var $data = $cpinput.data();

if (input == "random") {
  var data = {'url':'http://colormind.io/api/','method':'POST','data':{'model':'ui'}};
  data.callback = function(data){
  $data.values = data.result.map(value => RGBToHex(`rgb(${value})`));
  $cpinput.data($data).change();
  };
httpRq(data);
}

if (input == "default") {
$data.values = ["#888", "transparent"];
 $cpinput.data($data).change();
}
}

</script>

  <script src="https://unpkg.com/bootstrap@4.3.1/dist/js/bootstrap.bundle.min.js"></script>